{{- define "main" }}

{{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}

<div class="home-hero">
    <h1>{{ site.Params.author }}</h1>
    <p class="home-tagline">{{ site.Params.profileMode.title | default "Software engineering notes & explorations" }}</p>
</div>

{{- $featured := where $pages "Params.categories" "intersect" (slice "featured") }}

{{- if gt (len $featured) 0 }}
<section class="home-section">
    <h2 class="home-section-title">Featured</h2>
    <ul class="post-list-minimal">
        {{- range first 6 $featured }}
        <li>
            <a href="{{ .Permalink }}">
                <span class="post-list-title">{{ .Title }}</span>
                <span class="post-list-date">{{ .Date.Format "Jan 2006" }}</span>
            </a>
        </li>
        {{- end }}
    </ul>
    <a href="/blog/categories/featured/" class="see-all-link">See all featured posts &rarr;</a>
</section>
{{- end }}

{{- $recentPages := slice }}
{{- range $pages }}
    {{- $isFeatured := false }}
    {{- if .Params.categories }}
        {{- if in .Params.categories "featured" }}
            {{- $isFeatured = true }}
        {{- end }}
    {{- end }}
    {{- if not $isFeatured }}
        {{- $recentPages = $recentPages | append . }}
    {{- end }}
{{- end }}

{{- if gt (len $recentPages) 0 }}
<section class="home-section">
    <h2 class="home-section-title">Recent</h2>
    <ul class="post-list-minimal">
        {{- range first 10 $recentPages }}
        <li>
            <a href="{{ .Permalink }}">
                <span class="post-list-title">{{ .Title }}</span>
                <span class="post-list-date">{{ .Date.Format "Jan 2006" }}</span>
            </a>
        </li>
        {{- end }}
    </ul>
    <a href="/archives/" class="see-all-link">See all posts &rarr;</a>
</section>
{{- end }}

{{- end }}
